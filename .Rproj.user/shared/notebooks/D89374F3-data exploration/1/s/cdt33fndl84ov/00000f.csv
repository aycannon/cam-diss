"0",""
"0","tune_pt_params_rolling <- function(data, alphas, lambdas, window_size = 60, horizon = 1) {"
"0","  param_grid <- expand.grid(alpha = alphas, lambda = lambdas)"
"0","  results <- data.frame()"
"0","  "
"0","  n <- nrow(data)"
"0","  max_start <- n - window_size - horizon + 1"
"0","  "
"0","  pb <- progress_bar$new("
"0","    format = ""  tuning [:bar] :percent eta: :eta"","
"0","    total = nrow(param_grid), clear = FALSE, width = 60"
"0","  )"
"0","  "
"0","  for (i in 1:nrow(param_grid)) {"
"0","    alpha <- param_grid$alpha[i]"
"0","    lambda <- param_grid$lambda[i]"
"0","    rmse_vec <- c()"
"0","    "
"0","    for (start in 1:max_start) {"
"0","      train_idx <- start:(start + window_size - 1)"
"0","      test_idx <- (start + window_size):(start + window_size + horizon - 1)"
"0","      "
"0","      train <- data[train_idx, ]"
"0","      test <- data[test_idx, ]"
"0","      "
"0","      model <- lm(kt_value(excess, alpha, lambda) ~ prem, data = train)"
"0","      preds <- predict(model, newdata = test)"
"0","      y_true <- kt_value(test$excess, alpha, lambda)"
"0","      rmse <- sqrt(mean((y_true - preds)^2))"
"0","      "
"0","      rmse_vec <- c(rmse_vec, rmse)"
"0","    }"
"0","    "
"0","    results <- rbind(results, data.frame(alpha, lambda, RMSE = mean(rmse_vec)))"
"0","    pb$tick()"
"0","  }"
"0","  "
"0","  best <- results[which.min(results$RMSE), ]"
"0","  return(list(best_params = best, full_results = results))"
"0","}"
"0",""
"0",""
