"0","data <- df %>%"
"0","    mutate(Base = gsub(""="", """", Instrument))"
"0",""
"0","wide <- data %>%"
"0","    distinct() %>% # there are duplicates, but they are perfect duplicates so we take the distinct values"
"0","    dplyr::select(Base, Date, ""Mid Price"") %>%"
"0","    pivot_wider(names_from = Base, values_from = ""Mid Price"") %>%"
"0","    arrange(Date) %>%"
"0","    mutate(across(-Date, log))"
"0","# everything has been logged as we work in log(spot) and log(forward)"
"0","# now we need s_{t+1}"
"0",""
"0","spot_lagged <- wide %>%"
"0","  transmute(Date = Date %m+% months(1),  # shift date back by 1 month to align with t"
"0","            GBP_t1 = GBP,"
"0","            EUR_t1 = EUR,"
"0","            JPY_t1 = JPY,"
"0","            CAD_t1 = CAD,"
"0","            GBP_FWD = GBP1MV,"
"0","            EUR_FWD = EUR1MV,"
"0","            JPY_FWD = JPY1MV,"
"0","            CAD_FWD = CAD1MV)"
"0",""
"0","wide_data <- wide %>%"
"0","    inner_join(spot_lagged, by = ""Date"") %>%"
"0","    mutate(GBP_excess = GBP - GBP_t1,"
"0","           EUR_excess = EUR - EUR_t1,"
"0","           JPY_excess = JPY - JPY_t1,"
"0","           CAD_excess = CAD - CAD_t1,"
"0","           GBP_prem = GBP_FWD - GBP_t1,"
"0","           EUR_prem = EUR_FWD - EUR_t1,"
"0","           JPY_prem = JPY_FWD - JPY_t1,"
"0","           CAD_prem = CAD_FWD - CAD_t1)"
"0",""
