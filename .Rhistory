knitr::opts_chunk$set(echo = TRUE)
source("preamble.R")
df <- read_xlsx("data/data1.xlsx")
dt <- as.data.table(df)
list <- split(dt, by = names(dt)[1], keep.by = T)
list
df <- df %>%
rename_with(~ c("Inst", "Bid", "Ask", "Mid", "Date")) %>%
mutate(Date = as.Date(Date, format = "%Y-%m-%d"),
Inst = substr(Inst,1,nchar(Inst)-1))
df
head(df)
tail(df)
head(df)
tail(df)
df <- df %>%
rename_with(~ c("Inst", "Bid", "Ask", "Mid", "Date")) %>%
mutate(Date = as.Date(Date, format = "%Y-%m-%d"),
Inst = substr(Inst,1,nchar(Inst)-1),
Type = if_else(grepl("1MV|FWD", Instrument), "forward", "spot"),
Base = gsub("1MV=|=|FWD.*", "", Instrument))
df <- df %>%
rename_with(~ c("Inst", "Bid", "Ask", "Mid", "Date")) %>%
mutate(Date = as.Date(Date, format = "%Y-%m-%d"),
Inst = substr(Inst,1,nchar(Inst)-1),
Type = if_else(grepl("1MV|FWD", Inst), "forward", "spot"),
Base = gsub("1MV=|=|FWD.*", "", Inst))
head(df)
tail(df)
df <- df %>%
rename_with(~ c("Inst", "Bid", "Ask", "Mid", "Date")) %>%
mutate(Date = as.Date(Date, format = "%Y-%m-%d"),
Type = if_else(grepl("1MV|FWD", Inst), "forward", "spot"),
Base = gsub("1MV=|=|FWD.*", "", Inst))
df <- read_xlsx("data/data1.xlsx") %>%
rename_with(~ c("Inst", "Bid", "Ask", "Mid", "Date")) %>%
mutate(Date = as.Date(Date, format = "%Y-%m-%d"),
Type = if_else(grepl("1MV|FWD", Inst), "forward", "spot"),
Base = gsub("1MV=|=|FWD.*", "", Inst))
head(df)
tail(df)
?lead
spot_df <- df %>%
filter(Type == "spot") %>%
select(Base, SpotDate = Date, SpotMid = Mid)
spot_df <- df %>%
filter(Type == "spot") %>%
dplyr::select(Base, SpotDate = Date, SpotMid = Mid)
fwd_df <- df %>%
filter(Type == "forward") %>%
dplyr::select(Base, Date, FwdMid = Mid) %>%
mutate(FwdDate = Date %m+% months(1))
df1 <- fwd_df %>%
inner_join(spot_df, by = c("Base", "FwdDate" = "SpotDate"))
df1
fwd_df
spot_df
df1
?ln
dfl <- df1 %>%
mutate(spot = log(SpotMid),
fwd = log(FwdMid),
prem = fwd - spot,
excess = spot - fwd)
dfl
?mutate
ggplot(dfl, aes(x = FwdDate, y = prem)) +
geom_line(aes(color = Base)) +
labs(title = "Forward Premiums",
x = "Date",
y = "Premium") +
theme_minimal() +
scale_color_manual(values = c("blue", "red", "green", "purple")) +
theme(legend.position = "bottom")
ggplot(dfl, aes(x = FwdDate, y = prem)) +
density(aes(color = Base))
ggplot(dfl, aes(x = excess, y = prem)) +
density(aes(color = Base))
dfl <- df1 %>%
mutate(spot = as.numeric(log(SpotMid)),
fwd = as.numeric(log(FwdMid)),
prem = fwd - spot,
excess = spot - fwd)
dfl
dfl <- df1 %>%
mutate(spot = as.numeric(log(SpotMid)),
fwd = as.numeric(log(FwdMid)),
prem = as.numeric(fwd - spot),
excess = as.numeric(spot - fwd))
```
dfl
ggplot(dfl, aes(x = excess, y = prem)) +
density(aes(color = Base))
df1
spot_df <- df %>%
filter(Type == "spot") %>%
dplyr::select(Base, SpotDate = Date, s_t = Mid)
dfl <- df1 %>%
mutate(spot = as.numeric(log(s_t)),
fwd = as.numeric(log(FwdMid)),
prem = as.numeric(fwd - spot),
excess = as.numeric(spot - fwd))
df1 <- fwd_df %>%
inner_join(spot_df, by = c("Base", "FwdDate" = "SpotDate"))
dfl <- df1 %>%
mutate(spot = as.numeric(log(s_t)),
fwd = as.numeric(log(FwdMid)),
prem = as.numeric(fwd - spot),
excess = as.numeric(spot - fwd))
dfl
?xts
df1
spot_df
spot_t <- df %>%
filter(Type == "spot") %>%
dplyr::select(Base, SpotDate = Date, s_t = Mid)
spot_t
spot_t1 <- df %>%
filter(Type == "spot") %>%
dplyr::select(Base, SpotDate = Date, s_t1 = Mid) %>%
mutate(date1 = SpotDate %m+% months(-1))
spot_t1
spot_df <- spot_t %>%
inner_join(spot_t1, by = c("Base", "SpotDate" = "date1"))
spot_df
spot_t1 <- df %>%
filter(Type == "spot") %>%
dplyr::select(Base, Spot1Date = Date, s_t1 = Mid) %>%
mutate(date1 = SpotDate %m+% months(-1))
spot_t1 <- df %>%
filter(Type == "spot") %>%
dplyr::select(Base, Spot1Date = Date, s_t1 = Mid) %>%
mutate(date1 = SpotDate %m+% months(-1))
spot_t1 <- df %>%
filter(Type == "spot") %>%
dplyr::select(Base, Spot1Date = Date, s_t1 = Mid) %>%
mutate(date1 = Spot1Date %m+% months(-1))
spot_df <- spot_t %>%
inner_join(spot_t1, by = c("Base", "SpotDate" = "date1"))
spot_df
fwd_df
spot_df <- spot_t %>%
inner_join(spot_t1, by = c("Base", "SpotDate" = "date1")) %>%
mutate(
spot = as.numeric(log(s_t)),
spot1 = as.numeric(log(s_t1)),
excess = as.numeric(spot1 - spot)
)
spot_df
df
fwd_df
spot_df
fwd_df <- df %>%
filter(Type == "forward") %>%
dplyr::select(Base, Date, FwdMid = Mid)
fwd_df
df1 <- fwd_df %>%
inner_join(spot_df, by = c("Base", "Date" = "SpotDate"))
df1
df1 <- fwd_df %>%
inner_join(spot_df, by = c("Base", "Date" = "SpotDate")) %>%
mutate(
f_t = as.numeric(FwdMid),
fwd = log(f_t),
prem = as.numeric(fwd - spot)
)
df1
df1 <- fwd_df %>%
inner_join(spot_df, by = c("Base", "Date" = "SpotDate")) %>%
mutate(
f_t = as.numeric(FwdMid),
fwd = log(f_t),
prem = as.numeric(fwd - spot)
)
df1
ggplot(df1, aes(x = FwdDate, y = s_t)) +
geom_line(aes(color = Base)) +
labs(title = "Spot Rates",
x = "Date",
y = "Spot") +
theme_minimal() +
scale_color_manual(values = c("blue", "red", "green", "purple")) +
theme(legend.position = "bottom")
ggplot(df1, aes(x = Date, y = s_t)) +
geom_line(aes(color = Base)) +
labs(title = "Spot Rates",
x = "Date",
y = "Spot") +
theme_minimal() +
scale_color_manual(values = c("blue", "red", "green", "purple")) +
theme(legend.position = "bottom")
ggplot(df1, aes(x = Date, y = prem)) +
geom_line(aes(color = Base)) +
labs(title = "Forward Premiums",
x = "Date",
y = "Premium") +
theme_minimal() +
scale_color_manual(values = c("blue", "red", "green", "purple")) +
theme(legend.position = "bottom")
ggplot(df1, aes(x = Date, y = prem)) +
geom_line(aes(color = Base, alpha = 0.5)) +
labs(title = "Forward Premiums",
x = "Date",
y = "Premium") +
theme_minimal() +
scale_color_manual(values = c("blue", "red", "green", "purple")) +
theme(legend.position = "bottom")
ggplot(df1, aes(x = Date, y = prem)) +
geom_line(aes(color = Base, alpha = 0.8)) +
labs(title = "Forward Premiums",
x = "Date",
y = "Premium") +
theme_minimal() +
scale_color_manual(values = c("blue", "red", "green", "purple")) +
theme(legend.position = "bottom")
ggplot(df1, aes(x = Date, y = prem)) +
geom_line(aes(color = Base)) +
labs(title = "Forward Premiums",
x = "Date",
y = "Premium") +
theme_minimal() +
scale_color_manual(values = c("blue", "red", "green", "purple")) +
theme(legend.position = "bottom")
simple <- lm(excess ~ prem, data = df1)
simple
simple <- df1 %>%
group_by(Base) %>%
do(tidy(lm(excess ~ prem, data = .))) %>%
ungroup()
simple
linearHypothesis(lm(excess ~ prem, data = df1 %>% filter(Base == "GBP")), "prem = 1")
?car
??car
install.packages("car")
library(car)
linearHypothesis(lm(excess ~ prem, data = df1 %>% filter(Base == "GBP")), "prem = 1")
gbp <- df1 %>%
filter(Base == "GBP")
source("preamble.R")
linearHypothesis(lm(excess ~ prem, data = df1 %>% filter(Base == "GBP")), "prem = 1")
simple
linearHypothesis(lm(excess ~ prem, data = df1 %>% filter(Base == "EUR")), "prem = 1")
ab <- linearHypothesis(lm(excess ~ prem, data = df1 %>% filter(Base == "GBP")), "prem = 1")
ab
?for\
?for
currencies <- unique(df1$Base)
for (base in currencies){
print("\nCurrency: ", base, "\n")
linearHypothesis(lm(excess ~ prem, data = df1 %>% filter(Base == base)), "prem = 1")
}
currencies
base
for (base in currencies){
print("\nCurrency: ", base, "\n")
linearHypothesis(lm(excess ~ prem, data = df1 %>% filter(Base == base)), "prem = 1")
}
# print("\nCurrency: ", base, "\n")
linearHypothesis(lm(excess ~ prem, data = df1 %>% filter(Base == base)), "prem = 1")
for (base in currencies){
# print("\nCurrency: ", base, "\n")
linearHypothesis(lm(excess ~ prem, data = df1 %>% filter(Base == base)), "prem = 1")
}
for (base in currencies){
# print("\nCurrency: ", base, "\n")
linearHypothesis(lm(excess ~ prem, data = df1 %>% filter(Base == base)), "prem = 1")
}
for (base in currencies){
# print("\nCurrency: ", base, "\n")
m <- lm(excess ~ prem, data = df1 %>% filter(Base == base))
print(linearHypothesis(m, "prem = 1")))
for (base in currencies){
m <- lm(excess ~ prem, data = df1 %>% filter(Base == base))
print(linearHypothesis(m, "prem = 1")))
for (base in currencies){
m <- lm(excess ~ prem, data = df1 %>% filter(Base == base))
print(linearHypothesis(m, "prem = 1"))
}
for (base in currencies){
print(base)
m <- lm(excess ~ prem, data = df1 %>% filter(Base == base))
print(linearHypothesis(m, "prem = 1"))
}
for (base in currencies){
print("--------------",base,"--------------")
m <- lm(excess ~ prem, data = df1 %>% filter(Base == base))
print(linearHypothesis(m, "prem = 1"))
}
for (base in currencies){
print("\n--------------", base , "--------------")
m <- lm(excess ~ prem, data = df1 %>% filter(Base == base))
print(linearHypothesis(m, "prem = 1"))
}
for (base in currencies){
cat("--------------", base , "--------------")
m <- lm(excess ~ prem, data = df1 %>% filter(Base == base))
print(linearHypothesis(m, "prem = 1"))
}
install.packages("quantreg")
library(quantreg)
qr <- rq(excess ~ prem, data = df1, tau = c(0.25, 0.5, 0.75))
qr
qr <- rq(excess ~ prem, data = df1%>% filter(Base == "GBP"), tau = c(0.25, 0.5, 0.75))
qr
?rq
linearHypothesis(qr, "prem = 1")
summary(qr)
?summary
